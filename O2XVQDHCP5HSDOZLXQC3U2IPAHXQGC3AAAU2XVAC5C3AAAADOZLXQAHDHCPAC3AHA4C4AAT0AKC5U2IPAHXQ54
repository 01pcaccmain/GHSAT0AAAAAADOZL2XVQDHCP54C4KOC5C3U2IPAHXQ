local P,RS,Rep,VI=game.Players,game:GetService("RunService"),game:GetService("ReplicatedStorage"),game:GetService("VirtualInputManager")
local Pl,Pn= P.LocalPlayer, P.LocalPlayer:GetMouse()
local MAX,TLT,ATT,RD,CD,TOOL,ATTR,TEAM,SPECT,BFL=5000,3,3,0.5,0.1,"steal food","CurrentFood","Barbarian","Spectating",189
local LT,AT,Dead=0,false,false

local G=Instance.new("ScreenGui",Pl:WaitForChild("PlayerGui"));G.Name="ControlUI";G.ResetOnSpawn=false
local F=Instance.new("Frame",G);F.Size=UDim2.new(0,160,0,140);F.Position=UDim2.new(0.4,0,0.25,0);F.BackgroundColor3=Color3.fromRGB(40,40,40);F.Active=true;F.Draggable=true
local B=Instance.new("TextButton",F);B.Size=UDim2.new(1,-20,0,30);B.Position=UDim2.new(0,10,0,10);B.BackgroundColor3=Color3.fromRGB(120,60,60);B.TextScaled=true;B.TextColor3=Color3.new(1,1,1);B.Text="Play"
B.MouseButton1Click:Connect(function() AT=not AT;B.Text=AT and"Pause"or"Play";B.BackgroundColor3=AT and Color3.fromRGB(70,100,70)or Color3.fromRGB(120,60,60)end)

local LOC={
["Town Food Supply"]=CFrame.new(60.2151184,14.9998245,288.914398,-0.899405062,2.18505e-06,0.437116176,0,1,-5.00857e-06,-0.437116176,-4.50681e-06,-0.899405062),
["Barb Food Supply"]=CFrame.new(60.6131096,-7.50010443,-1298.18335,-0.988649487,3.85588e-07,0.150240451,0,1,-2.4011e-06,-0.150240451,-2.37007e-06,-0.988649487),
["Spectate"]=CFrame.new(-199.437653,453.633545,-77.0826569,0.937276602,0,0.3485865,0,1,0,-0.3485865,0,0.937276602),
["Is Flooding"]=CFrame.new(1032.495117,182, -680.224426)
}

local PRESETS={
{town=CFrame.new(60.8134384,14.9998245,296.420868,0.8251147,0,0.5649652,0,1,0,-0.5649652,0,0.8251147), barb=CFrame.new(64.1458359,-7.50010443,-1292.34753,0.2486812,0,0.9685853,0,1,0,-0.9685853,0,0.2486812)},
{town=CFrame.new(54.9629631,14.9998245,295.918976,0.8007306,0,-0.5990245,0,1,0,0.5990245,0,0.8007306), barb=CFrame.new(58.469471,-7.50010443,-1289.39539,0.9510563,0,-0.3090176,0,1,0,0.3090176,0,0.9510563)},
{town=CFrame.new(54.3473587,14.9998245,290.32196,-0.4131035,0,-0.910684,0,1,0,0.910684,0,-0.4131035), barb=CFrame.new(55.8769493,-7.50010443,-1294.99854,-0.22156,0,-0.9751467,0,1,0,0.9751467,0,-0.22156)},
{town=CFrame.new(60.2151184,14.9998245,288.914398,-0.899405062,0,0.437116176,0,1,0,-0.437116176,0,-0.899405062), barb=CFrame.new(60.6131096,-7.50010443,-1298.18335,-0.988649487,0,0.150240451,0,1,0,-0.150240451,0,-0.988649487)}
}

local btnY,btnS,startBtn
for i,p in ipairs(PRESETS) do
 local b=Instance.new("TextButton",F)
 b.Size=UDim2.new(1,-20,0,20);b.Position=UDim2.new(0,10,0,40+(i-1)*25)
 b.BackgroundColor3=Color3.fromRGB(100,100,100);b.TextColor3=Color3.new(1,1,1);b.Text="Preset "..i
 b.MouseButton1Click:Connect(function()
  LOC["Town Food Supply"],LOC["Barb Food Supply"]=p.town,p.barb
  if startBtn then startBtn.BackgroundColor3=Color3.fromRGB(100,100,100)end
  b.BackgroundColor3=Color3.fromRGB(70,100,70); startBtn=b
 end)
end

local function isFlooding() local v=Rep:FindFirstChild("IsFlooding") return v and v:IsA("BoolValue") and v.Value end
local function isValid(c) return c and math.abs(c.Position.X)<=MAX and math.abs(c.Position.Y)<=MAX and math.abs(c.Position.Z)<=MAX end
local function touch(a,b) if a and b then firetouchinterest(a,b,0);firetouchinterest(a,b,1)end end
local function handleGuard(hrp)local g=workspace:FindFirstChild("GUARDONLY",true) if g then touch(hrp,g);task.wait(0.3)end end
local function equipTool() if not AT or isFlooding() then return end local c=Pl.Character if not c then return end local b=Pl:FindFirstChildOfClass("Backpack") if not b then return end local t=c:FindFirstChild(TOOL)or b:FindFirstChild(TOOL) if not t then return end if t.Parent==b then c.Humanoid:EquipTool(t)end pcall(function()t:Activate()end)end
local function safeTP(t,ignore) if not ignore and isFlooding() then return false end local c=Pl.Character if not c then return false end local h=c:FindFirstChildOfClass("Humanoid") local hrp=c:FindFirstChild("HumanoidRootPart") if not h or not hrp or h.Health<=0 or not isValid(t) then return false end for _=1,ATT do if not ignore and isFlooding() then return false end handleGuard(hrp);hrp.CFrame=t;task.wait(0.25) if (hrp.Position-t.Position).Magnitude<=TLT then return true else task.wait(RD)end end return false end
local function getFood() local t=Pl.Backpack:FindFirstChild(TOOL)or(Pl.Character and Pl.Character:FindFirstChild(TOOL)) if t and t:GetAttribute(ATTR)then return t:GetAttribute(ATTR)end end
local function getBarb() local v=Rep:FindFirstChild("BarbFood") if v and v:IsA("IntValue")then return v.Value end end
local function getHRP() local c=Pl.Character if not c then return end return c:FindFirstChild("HumanoidRootPart") end
local function getHum() local c=Pl.Character if not c then return end return c:FindFirstChildOfClass("Humanoid") end
local function onTeam(n) return Pl.Team and Pl.Team.Name==n end

local function teleportFood()
 if not AT or isFlooding() or not onTeam(TEAM) then return end
 local f=getFood() if not f then return end
 local b=getBarb()
 if b and b>BFL and f>=100 then return end
 local loc=(f>=100) and "Barb Food Supply"or"Town Food Supply"
 local hrp=getHRP()
 if not hrp or (hrp.Position-LOC[loc].Position).Magnitude<=TLT or tick()-LT<CD then return end
 LT=tick(); safeTP(LOC[loc])
end

local function spectate()
 if isFlooding() then return end
 local hrp=getHRP(); local t=LOC["Spectate"]
 if hrp and (hrp.Position-t.Position).Magnitude>TLT then safeTP(t) end
 local p=workspace:FindFirstChild("SpawnArea",true)
 if p then p=workspace.SpawnArea.Spawns.BarbarianSpawn.BarbarianNPC.BarbarianTP:FindFirstChild("ProximityPrompt") end
 if p then pcall(function() fireproximityprompt(p)end)end
end

task.spawn(function() while task.wait(0.5) do local h=getHum() if h then if h.Health<=0 and not Dead then Dead=true;VI:SendKeyEvent(true,Enum.KeyCode.Space,false,game);task.wait(0.1);VI:SendKeyEvent(false,Enum.KeyCode.Space,false,game) elseif h.Health>0 then Dead=false end end end end)
task.spawn(function() while task.wait(0.5) do local hrp=getHRP() if AT and hrp then if isFlooding() and not onTeam(SPECT) then local t=LOC["Is Flooding"] if (hrp.Position-t.Position).Magnitude>TLT then safeTP(t,true) end elseif not isFlooding() and onTeam(TEAM) then equipTool() end end end end)
task.spawn(function() while task.wait(1) do if AT and not isFlooding() then if onTeam(TEAM) then teleportFood() elseif onTeam(SPECT) then spectate() end end end end)
task.spawn(function() local c=Pl.Character or Pl.CharacterAdded:Wait();local h=c:WaitForChild("Humanoid") while true do if not h.AutoRotate then h:ChangeState(Enum.HumanoidStateType.Jumping) end task.wait(0.2)end end)

RS.Heartbeat:Connect(function()
 local fs=workspace:FindFirstChild("FoodSupplies")
 if fs then for _,n in ipairs({"TownSupply","BarbSupply"})do local s=fs:FindFirstChild(n) if s then for _,p in ipairs(s:GetChildren())do if p:IsA("BasePart")then p.CanCollide=false end end end end end
 local ts=fs and fs:FindFirstChild("TownSupply") and fs.TownSupply:FindFirstChild("Silo")
 local bs=fs and fs:FindFirstChild("BarbSupply") and fs.BarbSupply:FindFirstChild("Silo")
 if ts then ts.Position=Vector3.new(58,20,292.496765) end
 if bs then bs.Position=Vector3.new(60.11777,-3,-1293.98156) end
 local r=workspace:FindFirstChild("REBUILD")
 if r then if r:FindFirstChild("GrassSurface") then local t=r.GrassSurface:GetChildren()[20] if t and t:IsA("BasePart")then t:Destroy()end end
 if r:FindFirstChild("IslandBase")then local i=r.IslandBase:GetChildren()[16] if i and i:IsA("BasePart")then i.Size=Vector3.new(504,40,816)end end end
 local v=workspace:FindFirstChild("BarbarianVillage")
 if v and v:FindFirstChild("Terrain")then for _,p in ipairs(v.Terrain:GetChildren())do if p:IsA("BasePart") and p.CFrame==CFrame.new(0,-18,-1255)and p.Size~=Vector3.new(200,15,100)then p.Size=Vector3.new(200,15,100)end end end
 for _,d in ipairs(workspace:GetDescendants())do if d:IsA("Seat")or d:IsA("VehicleSeat")then d:Destroy()end end
end)

Pl.CameraMaxZoomDistance=10000
Pn.WheelForward:Connect(function() Pl.CameraMaxZoomDistance+=50 end)
Pn.WheelBackward:Connect(function() Pl.CameraMaxZoomDistance=math.max(0.5,Pl.CameraMaxZoomDistance-50)end)

RS.Heartbeat:Connect(function() if P.LocalPlayer.Team and P.LocalPlayer.Team.Name=="Leader" then P.LocalPlayer:Kick("You are on the Leader team!")end end)
